Network Device malware: bron: https://www.cisa.gov/news-events/alerts/2016/09/06/increasing-threat-network-infrastructure-devices-and-recommended

SYNful Knock

In September 2015, an attack known as SYNful Knock was disclosed. 
 SYNful Knock silently changes a router’s operating system image, thus allowing attackers to gain a foothold on a victim’s network. 
 The malware can be customized and updated once embedded. 
 When the modified malicious image is uploaded, it provides a backdoor into the victim’s network. 
 Using a crafted TCP SYN packet, a communication channel is established between the compromised device and the malicious command and control (C2) server. 
 The impact of this infection to a network or device is severe and most likely indicates that there may be additional backdoors or compromised devices on the network. 
 This foothold gives an attacker the ability to maneuver and infect other hosts and access sensitive data. 


The initial infection vector does not leverage a zero-day vulnerability. 
 Attackers either use the default credentials to log into the device or obtain weak credentials from other insecure devices or communications. 
 The implant resides within a modified IOS image and, when loaded, maintains its persistence in the environment, even after a system reboot. 
 Any further modules loaded by the attacker will only exist in the router’s volatile memory and will not be available for use after the device reboots. 
 However, these devices are rarely or never rebooted. 


To prevent the size of the image from changing, the malware overwrites several legitimate IOS functions with its own executable code. 
 The attacker examines the functionality of the router and determines functions that can be overwritten without causing issues on the router. 
 Thus, the overwritten functions will vary upon deployment. 


The attacker can utilize the secret backdoor password in three different authentication scenarios. 
 In these scenarios the implant first checks to see if the user input is the backdoor password. 
 If so, access is granted. 
 Otherwise, the implanted code will forward the credentials for normal verification of potentially valid credentials. 
 This generally raises the least amount of suspicion. 
 Cisco has provided an alert on this attack vector. 
 For more information, see the Cisco SYNful Knock Security Advisory. 


Other attacks against network infrastructure devices have also been reported, including more complicated persistent malware that silently changes the firmware on the device that is used to load the operating system so that the malware can inject code into the running operating system. 
 For more information, please see Cisco's description of the evolution of attacks on Cisco IOS devices


Cisco Adaptive Security Appliance (ASA)

A Cisco ASA device is a network device that provides firewall and Virtual Private Network (VPN) functionality. 
 These devices are often deployed at the edge of a network to protect a site’s network infrastructure, and to give remote users access to protected local resources. 


In June 2016, NCCIC received several reports of compromised Cisco ASA devices that were modified in an unauthorized way. 
 The ASA devices directed users to a location where malicious actors tried to socially engineer the users into divulging their credentials. 


It is suspected that malicious actors leveraged CVE-2014-3393
to inject malicious code into the affected devices. 
 The malicious actor would then be able to modify the contents of the Random Access Memory Filing System (RAMFS) cache file system and inject the malicious code into the appliance’s configuration. 
 Refer to the Cisco Security Advisory Multiple Vulnerabilities in Cisco ASA Software

for more information and for remediation details. 


In August 2016, a group known as “Shadow Brokers” publicly released a large number of files, including exploitation tools for both old and newly exposed vulnerabilities. 
 Cisco ASA devices were found to be vulnerable to the released exploit code. 
 In response, Cisco released an update to address a newly disclosed Cisco ASA Simple Network Management Protocol (SNMP) remote code execution vulnerability (CVE-2016-6366
). 
 In addition, one exploit tool targeted a previously patched Cisco vulnerability (CVE-2016-6367). 
 Although Cisco provided patches to fix this Cisco ASA command-line interface (CLI) remote code execution vulnerability in 2011, devices that remain unpatched are still vulnerable to the described attack. 
 Attackers may target vulnerabilities for months or even years after patches become available. 


Relevante oplossing:
5. Perform Out-of-Band Management

Out-of-Band (OoB) management uses alternate communication paths to remotely manage network infrastructure devices. 
 These dedicated paths can vary in configuration to include anything from virtual tunneling to physical separation. 
 Using OoB access to manage the network infrastructure will strengthen security by limiting access and separating user traffic from network management traffic. 
 OoB management provides security monitoring and can implement corrective actions without allowing the adversary who may have already compromised a portion of the network to observe these changes. 


OoB management can be implemented physically or virtually, or through a hybrid of the two. 
 Building additional physical network infrastructure is the most secure option for the network managers, although it can be very expensive to implement and maintain. 
 Virtual implementation is less costly, but still requires significant configuration changes and administration. 
 In some situations, such as access to remote locations, virtual encrypted tunnels may be the only viable option. 

Recommendations:

    Segregate standard network traffic from management traffic. 

    Enforce that management traffic on devices only comes from the OoB. 

    Apply encryption to all management channels. 

    Encrypt all remote access to infrastructure devices such as terminal or dial-in servers. 

    Manage all administrative functions from a dedicated host (fully patched) over a secure channel, preferably on the OoB. 

    Harden network management devices by testing patches, turning off unnecessary services on routers and switches, and enforcing strong password policies. 
	
	Monitor the network and review logs Implement access controls that only permit required administrative or management services (SNMP, NTP SSH, FTP, TFTP). 
 


Exploits:
Shadow Broker Exploits 
Vendor 		CVE 			Exploit Name 		Vulnerability
Fortinet 	CVE-2016-6909	EGREGIOUSBLUNDER 	Authentication cookie overflow
WatchGuard  CVE-2016-7089	ESCALATEPLOWMAN 	Command line injection via ipconfig
Cisco 		CVE-2016-6366	EXTRABACON 			SNMP remote code execution
Cisco 		CVE-2016-6367	EPICBANANA 			Command line injection remote code execution
Cisco 		CVE-2016-6415	BENIGNCERTAIN/PIXPOCKET	Information/memory leak
TOPSEC 		N/A 			ELIGIBLEBACHELOR 	Attack vector unknown, but has an XML-like payloadbeginning with <?tos length="001e.%8.8x"?
TOPSEC 		N/A 			ELIGIBLEBOMBSHELL 	HTTP cookie command injection
TOPSEC 		N/A 			ELIGIBLECANDIDATE 	HTTP cookie command injection
TOPSEC 		N/A 			ELIGIBLECONTESTANT 	HTTP POST parameter injection